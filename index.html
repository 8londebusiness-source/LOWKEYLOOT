<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guild Loot Tracker</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#0e1117; color:#e6edf3; margin:0; }
    header { padding:16px 20px; border-bottom:1px solid #2d333b; position:sticky; top:0; background:#0e1117; z-index:5;}
    .wrap { max-width:1100px; margin:0 auto; padding:20px;}
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap:16px; }
    .card { background:#161b22; border:1px solid #2d333b; border-radius:14px; padding:14px; transition:transform .16s ease, box-shadow .2s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(0,0,0,.35); }
    .row { display:flex; align-items:center; gap:10px; }
    img.icon { width:38px; height:38px; border-radius:8px; border:1px solid #30363d; background:#0b0f14; object-fit:cover; }
    .name { font-weight:700; font-size:15px; line-height:1.2; }
    .tags { margin-top:10px; display:flex; gap:6px; flex-wrap:wrap; }
    .tag { background:#21262d; border:1px solid #30363d; color:#c9d1d9; padding:4px 8px; border-radius:100px; font-size:12px;}
    dialog { background:#0f141a; color:#e6edf3; border:1px solid #2d333b; border-radius:12px; width:min(520px, 92vw); }
    dialog::backdrop { background: rgba(0,0,0,.5); backdrop-filter: blur(1px); }
    .modal-head { padding:16px 18px; border-bottom:1px solid #22272e; font-weight:700 }
    .modal-body { padding:16px 18px; }
    .btn { background:#238636; border:none; color:white; padding:8px 10px; border-radius:8px; font-weight:600; cursor:pointer; }
    .search { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2d333b; background:#0b0f14; color:#e6edf3; }
    .muted { color:#9aa6b2; font-size:13px; }
    footer { color:#8b949e; font-size:12px; text-align:center; padding:24px; border-top:1px solid #2d333b; margin-top:30px;}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row" style="justify-content:space-between;">
        <div class="row">
          <h1 style="font-size:18px; margin:0 8px 0 0;">Guild Loot Tracker</h1>
          <span class="muted">click an item to see the next-in-line list</span>
        </div>
        <input id="q" class="search" style="max-width:360px;" placeholder="Search items or names..." />
      </div>
    </div>
  </header>
  <div class="wrap">
    <div id="grid" class="grid"></div>
  </div>

  <dialog id="dlg">
    <div class="modal-head" id="dlg-title">Item</div>
    <div class="modal-body">
      <div id="dlg-body"></div>
    </div>
  </dialog>

  <script>
    const state = { rows: [], filtered: [] };

    async function loadCSV(path) {
      const res = await fetch(path);
      const text = await res.text();
      // simple CSV parse (no commas in fields for our data)
      const lines = text.split('\n').filter(Boolean);
      const [hdr, ...rows] = lines;
      const cols = hdr.split(',').map(s => s.trim());
      return rows.map(line => {
        // handle commas safely
        const parts = line.split(/,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/).map(s => s.replace(/^"|"$/g,''));
        const rec = {};
        cols.forEach((c, i) => rec[c] = (parts[i]||'').trim());
        return rec;
      });
    }

    function render() {
      const grid = document.getElementById('grid');
      grid.innerHTML = '';
      for (const r of state.filtered) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = \`
          <div class="row">
            <img class="icon" alt="" src="\${r.icon_url || 'https://static.icy-veins.com/images/classic/icons/inv_misc_questionmark.jpg'}" />
            <div>
              <div class="name">\${r.full_name || r.item}</div>
              <div class="muted">\${r.item !== r.full_name ? r.item : ''}</div>
            </div>
          </div>
          <div class="tags">
            \${['next1','next2','next3'].map(k => r[k]).filter(Boolean).map(n => '<span class="tag">'+n+'</span>').join('')}
          </div>
        \`;
        card.onclick = () => openModal(r);
        grid.appendChild(card);
      }
    }

    function openModal(r) {
      const dlg = document.getElementById('dlg');
      document.getElementById('dlg-title').textContent = r.full_name || r.item;
      const names = [r.next1, r.next2, r.next3].filter(Boolean);
      document.getElementById('dlg-body').innerHTML = names.length
        ? '<div style="display:flex;gap:6px;flex-wrap:wrap;">' + names.map(n => '<span class="tag">'+n+'</span>').join('') + '</div>'
        : '<span class="muted">No names listed</span>';
      dlg.showModal();
      dlg.onclick = (e) => { if (e.target === dlg) dlg.close(); };
    }

    function setupSearch() {
      const q = document.getElementById('q');
      q.addEventListener('input', () => {
        const t = q.value.toLowerCase();
        state.filtered = state.rows.filter(r =>
          (r.full_name||'').toLowerCase().includes(t) ||
          (r.item||'').toLowerCase().includes(t) ||
          (r.next1||'').toLowerCase().includes(t) ||
          (r.next2||'').toLowerCase().includes(t) ||
          (r.next3||'').toLowerCase().includes(t)
        );
        render();
      });
    }

    (async () => {
      state.rows = await loadCSV('loot_with_icon_urls.csv');
      state.filtered = state.rows;
      setupSearch();
      render();
    })();
  </script>
  <footer>Generated for you ✨ — update the CSV to change the site contents.</footer>
</body>
</html>
